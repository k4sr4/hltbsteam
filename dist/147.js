"use strict";(self.webpackChunkhltb_steam_extension=self.webpackChunkhltb_steam_extension||[]).push([[147],{147:(e,t,i)=>{i.d(t,{titleMatcher:()=>l});class r{constructor(){this.SPECIAL_CHARS=/[®™©]/g,this.PUNCTUATION=/[:'"\-–—]/g,this.WHITESPACE=/\s+/g,this.ARTICLES=/^(the|a|an)\s+/i}normalize(e,t="standard"){if(!e)return"";let i=e;switch(t){case"minimal":i=this.removeSpecialChars(i),i=this.normalizeWhitespace(i),i=this.toLowerCase(i);break;case"standard":i=this.removeSpecialChars(i),i=this.removePunctuation(i),i=this.normalizeWhitespace(i),i=this.toLowerCase(i);break;case"aggressive":i=this.removeSpecialChars(i),i=this.removePunctuation(i),i=this.removeArticles(i),i=this.removeSubtitles(i),i=this.removeEditions(i),i=this.expandAcronyms(i),i=this.normalizeNumbers(i),i=this.normalizeWhitespace(i),i=this.toLowerCase(i)}return i.trim()}removeSpecialChars(e){return e.replace(this.SPECIAL_CHARS,"")}removePunctuation(e){return e.replace(this.PUNCTUATION," ")}normalizeWhitespace(e){return e.replace(this.WHITESPACE," ")}toLowerCase(e){return e.toLowerCase()}removeArticles(e){return e.replace(this.ARTICLES,"")}removeSubtitles(e){const t=e.match(/^([^:–\-]+)/);return t?t[1].trim():e}removeEditions(e){let t=e.toLowerCase();return["game of the year edition","goty edition","goty","definitive edition","enhanced edition","special edition","deluxe edition","ultimate edition","complete edition","collectors edition","gold edition","platinum edition","remastered","remake","directors cut","digital deluxe"].forEach(e=>{const i=new RegExp(`\\s*[-–]?\\s*${e}\\s*$`,"gi");t=t.replace(i,"")}),t.trim()}expandAcronyms(e){const t={"cs:go":"counter strike global offensive",csgo:"counter strike global offensive","cs go":"counter strike global offensive",pubg:"playerunknowns battlegrounds",gta:"grand theft auto",cod:"call of duty",bf:"battlefield",r6:"rainbow six",r6s:"rainbow six siege",dota:"defense of the ancients",tf2:"team fortress 2",mw:"modern warfare",mw2:"modern warfare 2",mw3:"modern warfare 3",bo:"black ops",bo2:"black ops 2",bo3:"black ops 3",bo4:"black ops 4"},i=e.toLowerCase().trim();if(t[i])return t[i];for(const[r,a]of Object.entries(t))if(i.startsWith(r+" ")||i.startsWith(r+":"))return e.replace(new RegExp(`^${r}`,"i"),a);return e}normalizeNumbers(e){let t=e.toLowerCase();return Object.entries({" ii":" 2"," iii":" 3"," iv":" 4"," v":" 5"," vi":" 6"," vii":" 7"," viii":" 8"," ix":" 9"," x":" 10"," xi":" 11"," xii":" 12"}).forEach(([e,i])=>{t=t.replace(new RegExp(e+"(?=\\s|$)","gi"),i)}),Object.entries({" one":" 1"," two":" 2"," three":" 3"," four":" 4"," five":" 5"," six":" 6"," seven":" 7"," eight":" 8"," nine":" 9"," ten":" 10"}).forEach(([e,i])=>{t=t.replace(new RegExp(e+"(?=\\s|$)","gi"),i)}),t}getCoreWords(e,t=3){return this.normalize(e,"standard").split(" ").filter(e=>e.length>=t).filter(e=>!this.isCommonWord(e))}isCommonWord(e){return new Set(["the","a","an","and","or","of","in","on","at","to","for","with","from","by","as","is","was","edition","game","collection"]).has(e.toLowerCase())}extractYear(e){const t=e.match(/\((\d{4})\)/);if(t){const e=parseInt(t[1],10);if(e>=1980&&e<=(new Date).getFullYear()+2)return e}return null}removeYear(e){return e.replace(/\s*\(\d{4}\)\s*/g," ").trim()}normalizeAmpersands(e){return e.replace(/\s*&\s*/g," and ")}}new r;class a{levenshteinDistance(e,t){if(e===t)return 0;if(0===e.length)return t.length;if(0===t.length)return e.length;const i=[];for(let e=0;e<=t.length;e++)i[e]=[e];for(let t=0;t<=e.length;t++)i[0][t]=t;for(let r=1;r<=t.length;r++)for(let a=1;a<=e.length;a++)t.charAt(r-1)===e.charAt(a-1)?i[r][a]=i[r-1][a-1]:i[r][a]=Math.min(i[r-1][a-1]+1,i[r][a-1]+1,i[r-1][a]+1);return i[t.length][e.length]}levenshteinSimilarity(e,t){const i=Math.max(e.length,t.length);return 0===i?1:1-this.levenshteinDistance(e,t)/i}diceCoefficient(e,t){if(e===t)return 1;if(e.length<2||t.length<2)return 0;const i=this.getBigrams(e),r=this.getBigrams(t);return 0===i.length&&0===r.length?1:0===i.length||0===r.length?0:2*i.filter(e=>r.includes(e)).length/(i.length+r.length)}getBigrams(e){const t=[];for(let i=0;i<e.length-1;i++)t.push(e.substring(i,i+2));return t}jaro(e,t){if(e===t)return 1;if(!e.length||!t.length)return 0;const i=Math.floor(Math.max(e.length,t.length)/2)-1;if(i<1)return e===t?1:0;const r=new Array(e.length).fill(!1),a=new Array(t.length).fill(!1);let o=0,n=0;for(let n=0;n<e.length;n++){const s=Math.max(0,n-i),l=Math.min(n+i+1,t.length);for(let i=s;i<l;i++)if(!a[i]&&e[n]===t[i]){r[n]=a[i]=!0,o++;break}}if(0===o)return 0;let s=0;for(let i=0;i<e.length;i++)if(r[i]){for(;!a[s];)s++;e[i]!==t[s]&&n++,s++}return(o/e.length+o/t.length+(o-n/2)/o)/3}jaroWinkler(e,t,i=.1){const r=this.jaro(e,t);return r+this.commonPrefix(e,t,4)*i*(1-r)}commonPrefix(e,t,i){const r=Math.min(e.length,t.length,i);for(let i=0;i<r;i++)if(e[i]!==t[i])return i;return r}combinedSimilarity(e,t){return e===t?1:.3*this.diceCoefficient(e,t)+.4*this.jaroWinkler(e,t)+.3*this.levenshteinSimilarity(e,t)}wordSimilarity(e,t){const i=new Set(e.toLowerCase().split(/\s+/).filter(e=>e.length>0)),r=new Set(t.toLowerCase().split(/\s+/).filter(e=>e.length>0));if(0===i.size&&0===r.size)return 1;if(0===i.size||0===r.size)return 0;const a=[...i].filter(e=>r.has(e)).length;return a/(i.size+r.size-a)}fuzzyMatch(e,t){return[{score:this.combinedSimilarity(e,t),method:"combined"},{score:this.wordSimilarity(e,t),method:"word"},{score:this.diceCoefficient(e,t),method:"dice"},{score:this.jaroWinkler(e,t),method:"jaro-winkler"}].reduce((e,t)=>t.score>e.score?t:e)}isMatch(e,t,i=.8){return this.combinedSimilarity(e,t)>=i}getPercentage(e,t){return`${(100*this.combinedSimilarity(e,t)).toFixed(1)}%`}}new a;const o={"counter strike global offensive":"counter strike global offensive","cs go":"counter strike global offensive",csgo:"counter strike global offensive","counter strike 2":"counter strike 2",cs2:"counter strike 2",doom:"doom 2016","doom 2016":"doom 2016","doom 3":"doom 3","doom eternal":"doom eternal","doom 64":"doom 64","doom 1993":"doom","doom ii":"doom ii hell on earth",prey:"prey 2017","prey 2017":"prey 2017","prey 2006":"prey","hitman 3":"hitman 3 2021","hitman 2":"hitman 2 2018",hitman:"hitman 2016","call of duty modern warfare 2":"call of duty modern warfare ii 2022","modern warfare 2":"call of duty modern warfare ii 2022","modern warfare ii":"call of duty modern warfare ii 2022",mw2:"call of duty modern warfare ii 2022","call of duty modern warfare":"call of duty modern warfare 2019","modern warfare":"call of duty modern warfare 2019","call of duty black ops":"call of duty black ops","black ops":"call of duty black ops","god of war":"god of war 2018","god of war 2018":"god of war 2018","black mesa":"black mesa","half life alyx":"half life alyx","half life 2":"half life 2","resident evil 2":"resident evil 2 2019","resident evil 3":"resident evil 3 2020","resident evil 4":"resident evil 4 2023","final fantasy vii remake":"final fantasy vii remake intergrade","final fantasy 7 remake":"final fantasy vii remake intergrade","ff7 remake":"final fantasy vii remake intergrade","persona 4 golden":"persona 4 golden","persona 5 royal":"persona 5 royal","the elder scrolls v skyrim special edition":"the elder scrolls v skyrim","skyrim special edition":"the elder scrolls v skyrim",skyrim:"the elder scrolls v skyrim","dark souls remastered":"dark souls","dark souls prepare to die edition":"dark souls","bioshock remastered":"bioshock","bioshock 2 remastered":"bioshock 2","bioshock infinite complete edition":"bioshock infinite","mafia definitive edition":"mafia definitive edition","cyberpunk 2077":"cyberpunk 2077","it takes two":"it takes two","a way out":"a way out","fall guys":"fall guys ultimate knockout","among us":"among us",phasmophobia:"phasmophobia",valheim:"valheim","grand theft auto v":"grand theft auto 5","grand theft auto 5":"grand theft auto 5","gta v":"grand theft auto 5","gta 5":"grand theft auto 5","gta iv":"grand theft auto 4","gta 4":"grand theft auto 4","gta san andreas":"grand theft auto san andreas","tom clancys rainbow six siege":"rainbow six siege","rainbow six siege":"rainbow six siege","r6 siege":"rainbow six siege","the witcher 3 wild hunt":"the witcher 3 wild hunt","the witcher 3 wild hunt game of the year edition":"the witcher 3 wild hunt","the witcher 3 goty":"the witcher 3 wild hunt","witcher 3":"the witcher 3 wild hunt","sid meiers civilization vi":"civilization vi","civilization vi":"civilization vi","civilization 6":"civilization vi","civ 6":"civilization vi","halo the master chief collection":"halo the master chief collection","halo mcc":"halo the master chief collection","baldurs gate 3":"baldurs gate 3","baldurs gate iii":"baldurs gate 3","elden ring":"elden ring","dark souls iii":"dark souls 3","dark souls 3":"dark souls 3","sekiro shadows die twice":"sekiro shadows die twice","red dead redemption 2":"red dead redemption 2",rdr2:"red dead redemption 2",hades:"hades","hades ii":"hades ii","hades 2":"hades ii",portal:"portal","portal 2":"portal 2",dishonored:"dishonored","dishonored 2":"dishonored 2","dishonored death of the outsider":"dishonored death of the outsider","metro 2033":"metro 2033","metro last light":"metro last light","metro exodus":"metro exodus","assassins creed valhalla":"assassins creed valhalla","assassins creed odyssey":"assassins creed odyssey","ac valhalla":"assassins creed valhalla","ac odyssey":"assassins creed odyssey"},n=new Set(["team fortress 2","tf2","dota 2","counter strike 2","cs2","apex legends","valorant","league of legends","lol","warframe","path of exile","poe","lost ark","destiny 2","rocket league","overwatch","overwatch 2","rainbow six extraction","the finals","battlefield 2042","call of duty warzone","warzone","fortnite","pubg","playerunknowns battlegrounds"]),s={doom:{1993:"doom",2016:"doom 2016"},"modern warfare":{2007:"call of duty 4 modern warfare",2019:"call of duty modern warfare 2019"},"modern warfare 2":{2009:"call of duty modern warfare 2",2022:"call of duty modern warfare ii 2022"},"god of war":{2005:"god of war",2018:"god of war 2018"},prey:{2006:"prey",2017:"prey 2017"},"resident evil 2":{1998:"resident evil 2",2019:"resident evil 2 2019"},"resident evil 3":{1999:"resident evil 3 nemesis",2020:"resident evil 3 2020"},"resident evil 4":{2005:"resident evil 4",2023:"resident evil 4 2023"}},l=new class{constructor(){this.EXACT_MATCH_THRESHOLD=1,this.FUZZY_MATCH_THRESHOLD=.8,this.AGGRESSIVE_MATCH_THRESHOLD=.7,this.WORD_MATCH_THRESHOLD=.75,this.normalizer=new r,this.calculator=new a}async findBestMatch(e,t){const i=performance.now();if(!e||!t||0===t.length)return null;const r=this.normalizer.normalize(e,"standard");if(a=r,n.has(a))return{confidence:1,method:"skip",skip:!0,reason:"Multiplayer-only game with no completion times"};var a;const l=this.normalizer.extractYear(e);if(l){const i=function(e,t){return t&&s[e]&&s[e][t]||null}(r,l);if(i){const a=this.findExactNormalizedMatch(i,t);if(a)return console.log(`[TitleMatcher] Year-specific match found: ${e} -> ${a.gameName}`),{match:a,confidence:1,method:"year_specific",normalizedSteam:r,normalizedHltb:this.normalizer.normalize(a.gameName,"standard")}}}const d=function(e){return o[e]||null}(r);if(d){const i=this.findExactNormalizedMatch(d,t);if(i)return console.log(`[TitleMatcher] Manual mapping found: ${e} -> ${i.gameName}`),{match:i,confidence:1,method:"manual_mapping",normalizedSteam:r,normalizedHltb:this.normalizer.normalize(i.gameName,"standard")}}const c=this.findExactMatch(e,t);if(c)return console.log(`[TitleMatcher] Exact match found: ${e} -> ${c.gameName}`),{match:c,confidence:1,method:"exact",normalizedSteam:r,normalizedHltb:this.normalizer.normalize(c.gameName,"minimal")};const m=this.findFuzzyMatch(e,t,"standard");if(m&&m.confidence>=this.FUZZY_MATCH_THRESHOLD)return console.log(`[TitleMatcher] Fuzzy match found: ${e} -> ${m.match.gameName} (${(100*m.confidence).toFixed(1)}%)`),m;const h=this.findWordMatch(e,t);if(h&&h.confidence>=this.WORD_MATCH_THRESHOLD)return console.log(`[TitleMatcher] Word match found: ${e} -> ${h.match.gameName} (${(100*h.confidence).toFixed(1)}%)`),h;const f=this.findFuzzyMatch(e,t,"aggressive");if(f&&f.confidence>=this.AGGRESSIVE_MATCH_THRESHOLD)return console.log(`[TitleMatcher] Aggressive match found: ${e} -> ${f.match.gameName} (${(100*f.confidence).toFixed(1)}%)`),f;const u=performance.now()-i;return console.log(`[TitleMatcher] No match found for: ${e} (${u.toFixed(1)}ms)`),null}findExactMatch(e,t){const i=this.normalizer.normalize(e,"minimal");return t.find(e=>{const t=this.normalizer.normalize(e.gameName,"minimal");return i===t})||null}findExactNormalizedMatch(e,t){return t.find(t=>{const i=this.normalizer.normalize(t.gameName,"standard");return e===i})||null}findFuzzyMatch(e,t,i){const r=this.normalizer.normalize(e,i);let a=null,o=0;for(const e of t){const t=this.normalizer.normalize(e.gameName,i),n=this.calculator.combinedSimilarity(r,t);n>o&&(o=n,a=e)}return a&&o>=this.FUZZY_MATCH_THRESHOLD?{match:a,confidence:o,method:"standard"===i?"fuzzy_standard":"fuzzy_aggressive",normalizedSteam:r,normalizedHltb:this.normalizer.normalize(a.gameName,i)}:null}findWordMatch(e,t){const i=this.normalizer.normalize(e,"standard"),r=this.normalizer.getCoreWords(i,3);if(0===r.length)return null;let a=null,o=0;for(const e of t){const t=this.normalizer.normalize(e.gameName,"standard"),n=this.normalizer.getCoreWords(t,3);if(0===n.length)continue;const s=r.filter(e=>n.includes(e)).length/new Set([...r,...n]).size*.6+.4*this.calculator.combinedSimilarity(i,t);s>o&&(o=s,a=e)}return a&&o>=this.WORD_MATCH_THRESHOLD?{match:a,confidence:o,method:"word_match",normalizedSteam:i,normalizedHltb:this.normalizer.normalize(a.gameName,"standard")}:null}async batchMatch(e){const t=new Map;for(const{title:i,searchResults:r}of e){const e=await this.findBestMatch(i,r);t.set(i,e)}return t}async getMatchDetails(e,t){const i={steamNormalized:{minimal:this.normalizer.normalize(e,"minimal"),standard:this.normalizer.normalize(e,"standard"),aggressive:this.normalizer.normalize(e,"aggressive")},candidates:t.map(e=>{const t={minimal:this.normalizer.normalize(e.gameName,"minimal"),standard:this.normalizer.normalize(e.gameName,"standard"),aggressive:this.normalizer.normalize(e.gameName,"aggressive")},r={dice:this.calculator.diceCoefficient(i.steamNormalized.standard,t.standard),jaro:this.calculator.jaroWinkler(i.steamNormalized.standard,t.standard),levenshtein:this.calculator.levenshteinSimilarity(i.steamNormalized.standard,t.standard),combined:this.calculator.combinedSimilarity(i.steamNormalized.standard,t.standard),word:this.calculator.wordSimilarity(i.steamNormalized.standard,t.standard)};return{title:e.gameName,normalized:t,scores:r}})};return i}}}}]);