/*! For license information please see content.js.LICENSE.txt */
(()=>{function e(){var n,r,o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",c=o.toStringTag||"@@toStringTag";function i(e,o,a,c){var i=o&&o.prototype instanceof u?o:u,s=Object.create(i.prototype);return t(s,"_invoke",function(e,t,o){var a,c,i,u=0,s=o||[],d=!1,p={p:0,n:0,v:n,a:m,f:m.bind(n,4),d:function(e,t){return a=e,c=0,i=n,p.n=t,l}};function m(e,t){for(c=e,i=t,r=0;!d&&u&&!o&&r<s.length;r++){var o,a=s[r],m=p.p,f=a[2];e>3?(o=f===t)&&(i=a[(c=a[4])?5:(c=3,3)],a[4]=a[5]=n):a[0]<=m&&((o=e<2&&m<a[1])?(c=0,p.v=t,p.n=a[1]):m<f&&(o=e<3||a[0]>t||t>f)&&(a[4]=e,a[5]=t,p.n=f,c=0))}if(o||e>1)return l;throw d=!0,t}return function(o,s,f){if(u>1)throw TypeError("Generator is already running");for(d&&1===s&&m(s,f),c=s,i=f;(r=c<2?n:i)||!d;){a||(c?c<3?(c>1&&(p.n=-1),m(c,i)):p.n=i:p.v=i);try{if(u=2,a){if(c||(o="next"),r=a[o]){if(!(r=r.call(a,i)))throw TypeError("iterator result is not an object");if(!r.done)return r;i=r.value,c<2&&(c=0)}else 1===c&&(r=a.return)&&r.call(a),c<2&&(i=TypeError("The iterator does not provide a '"+o+"' method"),c=1);a=n}else if((r=(d=p.n<0)?i:e.call(t,p))!==l)break}catch(e){a=n,c=1,i=e}finally{u=1}}return{value:r,done:d}}}(e,a,c),!0),s}var l={};function u(){}function s(){}function d(){}r=Object.getPrototypeOf;var p=[][a]?r(r([][a]())):(t(r={},a,function(){return this}),r),m=d.prototype=u.prototype=Object.create(p);function f(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,t(e,c,"GeneratorFunction")),e.prototype=Object.create(m),e}return s.prototype=d,t(m,"constructor",d),t(d,"constructor",s),s.displayName="GeneratorFunction",t(d,c,"GeneratorFunction"),t(m),t(m,c,"Generator"),t(m,a,function(){return this}),t(m,"toString",function(){return"[object Generator]"}),(e=function(){return{w:i,m:f}})()}function t(e,n,r,o){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}t=function(e,n,r,o){function c(n,r){t(e,n,function(e){return this._invoke(n,r,e)})}n?a?a(e,n,{value:r,enumerable:!o,configurable:!o,writable:!o}):e[n]=r:(c("next",0),c("throw",1),c("return",2))},t(e,n,r,o)}function n(e,t,n,r,o,a,c){try{var i=e[a](c),l=i.value}catch(e){return void n(e)}i.done?t(l):Promise.resolve(l).then(r,o)}function r(){var e=window.location.href;return e.includes("store.steampowered.com/app/")||e.includes("steamcommunity.com/app/")}function o(){return a.apply(this,arguments)}function a(){var t;return t=e().m(function t(){var n,r,o,a;return e().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,chrome.runtime.sendMessage({action:"getSettings"});case 1:if((n=e.v).success&&n.settings.enabled){e.n=2;break}return console.log("[HLTB] Extension is disabled"),e.a(2);case 2:if(r=c()){e.n=3;break}return console.warn("[HLTB] Could not extract game info"),e.a(2);case 3:return console.log("[HLTB] Game detected:",r),e.n=4,chrome.runtime.sendMessage({action:"fetchHLTB",gameTitle:r.title,appId:r.appId});case 4:(o=e.v).success&&o.data?(console.log("[HLTB] Data received:",o.data),i(o.data)):console.error("[HLTB] Failed to fetch data:",o.error||"No data returned"),e.n=6;break;case 5:e.p=5,a=e.v,console.error("[HLTB] Extension error:",a);case 6:return e.a(2)}},t,null,[[0,5]])}),a=function(){var e=this,r=arguments;return new Promise(function(o,a){var c=t.apply(e,r);function i(e){n(c,o,a,i,l,"next",e)}function l(e){n(c,o,a,i,l,"throw",e)}i(void 0)})},a.apply(this,arguments)}function c(){var e=window.location.href,t=e.match(/\/app\/(\d+)/);if(!t)return null;var n="",r=e.match(/\/app\/\d+\/([^\/\?#]+)/);if(r&&(n=r[1].replace(/_/g," ").replace(/%20/g," ").trim()),!n){var o=document.querySelector("#appHubAppName");o&&(n=o.textContent.trim())}if(!n){var a=document.querySelector('meta[property="og:title"]');null!=a&&a.content&&(n=a.content.replace(/ on Steam$/,"").replace(/^Save \d+% on /,"").trim())}return n||(n=document.title.replace(/ on Steam$/,"").replace(/^Save \d+% on /,"").trim()),{appId:t[1],title:n}}function i(e){var t=function(e){return null==e?"--":"number"==typeof e?0===e?"--":e+(1===e?" Hour":" Hours"):"string"==typeof e&&e||"--"},n=document.createElement("div");n.className="hltb-container",e.source&&n.setAttribute("data-source",e.source),e.confidence&&n.setAttribute("data-confidence",e.confidence);var r=document.createElement("div");r.className="hltb-header";var o=document.createElement("span");o.className="hltb-logo",o.textContent="HLTB";var a=document.createElement("span");if(a.className="hltb-title",a.textContent="HowLongToBeat",e.source&&"api"!==e.source){var c=document.createElement("span");c.className="hltb-source";var i="cache"===e.source?"cached":"scraper"===e.source?"scraped":"fallback"===e.source?"estimated":"";i&&(c.textContent="(".concat(i,")"),a.appendChild(document.createTextNode(" ")),a.appendChild(c))}r.appendChild(o),r.appendChild(a);var l=document.createElement("div");l.className="hltb-times";var u=[{label:"Main Story",value:t(e.mainStory)},{label:"Main + Extra",value:t(e.mainExtra)},{label:"Completionist",value:t(e.completionist)}];if(null===e.mainStory&&null===e.mainExtra&&null===e.completionist){var s=document.createElement("div");s.className="hltb-multiplayer-notice",s.textContent="Multiplayer Game - No completion times",l.appendChild(s)}else u.forEach(function(e){var t=e.label,n=e.value,r=document.createElement("div");r.className="hltb-time-box","--"===n&&r.classList.add("hltb-no-data");var o=document.createElement("div");o.className="hltb-label",o.textContent=t;var a=document.createElement("div");a.className="hltb-hours",a.textContent=n,r.appendChild(o),r.appendChild(a),l.appendChild(r)});n.appendChild(r),n.appendChild(l);for(var d=!1,p=0,m=[".game_area_purchase",".game_area_purchase_game",".apphub_AppName",".apphub_HomeHeader",".rightcol",".game_meta_data","#appHubAppName"];p<m.length;p++){var f=m[p],h=document.querySelector(f);if(h){f.includes("apphub")||f.includes("appHub")?h.parentNode.insertBefore(n,h.nextSibling):h.parentNode.insertBefore(n,h),console.log("[HLTB] UI injected successfully at:",f),d=!0;break}}d||console.warn("[HLTB] Could not find injection point")}console.log("[HLTB] Content script loaded on:",window.location.href),r()&&o();var l=window.location.href;new MutationObserver(function(){window.location.href!==l&&(l=window.location.href,console.log("[HLTB] Navigation detected"),r()&&o())}).observe(document.body,{childList:!0,subtree:!0})})();